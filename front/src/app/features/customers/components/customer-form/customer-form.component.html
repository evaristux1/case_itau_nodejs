<div class="customer-form">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <button mat-icon-button (click)="goBack()">
          <mat-icon>arrow_back</mat-icon>
        </button>
        {{ isEditMode() ? "Editar Cliente" : "Novo Cliente" }}
      </mat-card-title>
    </mat-card-header>

    @if (isLoading()) {
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    }

    <mat-card-content>
      <form [formGroup]="customerForm" (ngSubmit)="onSubmit()">
        <div class="form-grid">
          <mat-form-field appearance="outline">
            <mat-label>Nome completo</mat-label>
            <input
              matInput
              formControlName="name"
              placeholder="Digite o nome completo"
            />
            @if (customerForm.get('name')?.hasError('required')) {
            <mat-error> Nome é obrigatório </mat-error>
            } @if (customerForm.get('name')?.hasError('minlength')) {
            <mat-error> Nome deve ter pelo menos 2 caracteres </mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>E-mail</mat-label>
            <input
              matInput
              type="email"
              formControlName="email"
              placeholder="Digite o e-mail"
            />
            @if (customerForm.get('email')?.hasError('required')) {
            <mat-error> E-mail é obrigatório </mat-error>
            } @if (customerForm.get('email')?.hasError('email')) {
            <mat-error> E-mail deve ser válido </mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>CPF</mat-label>
            <input
              matInput
              formControlName="document"
              placeholder="000.000.000-00"
              (input)="onCpfInput($event)"
              maxlength="14"
            />
            @if (customerForm.get('document')?.hasError('required')) {
            <mat-error> CPF é obrigatório </mat-error>
            } @if (customerForm.get('document')?.hasError('invalidCpf')) {
            <mat-error> CPF deve ser válido </mat-error>
            }
          </mat-form-field>

          @if (!isEditMode()) {
          <mat-form-field appearance="outline">
            <mat-label>Senha</mat-label>
            <input
              matInput
              type="password"
              formControlName="password"
              placeholder="Digite a senha"
            />
            @if (customerForm.get('password')?.hasError('required')) {
            <mat-error> Senha é obrigatória </mat-error>
            } @if (customerForm.get('password')?.hasError('minlength')) {
            <mat-error> Senha deve ter pelo menos 6 caracteres </mat-error>
            }
          </mat-form-field>
          }
        </div>
      </form>
    </mat-card-content>

    <mat-card-actions align="end">
      <button mat-button type="button" (click)="goBack()">Cancelar</button>
      <button
        mat-raised-button
        color="primary"
        (click)="onSubmit()"
        [disabled]="customerForm.invalid || isLoading()"
      >
        {{ isEditMode() ? "Atualizar" : "Criar" }}
      </button>
    </mat-card-actions>
  </mat-card>
</div>
