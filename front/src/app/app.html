<div class="app-container">
  <!-- Loading Bar Global -->
  @if (loadingService.isLoading()) {
  <mat-progress-bar
    mode="indeterminate"
    class="global-loading"
  ></mat-progress-bar>
  }

  <!-- Header/Navbar -->
  @if (authService.isAuthenticated()) {
  <header class="app-header">
    <mat-toolbar color="primary" class="app-toolbar">
      <!-- Brand Section -->
      <div class="brand-section">
        <div class="brand-icon-wrapper">
          <mat-icon class="brand-icon">account_balance</mat-icon>
        </div>
        <div class="brand-info">
          <span class="brand-title">Itaú Customer</span>
          <span class="brand-subtitle">Management</span>
        </div>
      </div>

      <!-- Spacer -->
      <div class="nav-spacer"></div>

      <!-- Desktop Navigation -->
      <nav class="desktop-nav">
        <div class="nav-links">
          <a
            mat-button
            routerLink="/dashboard"
            class="nav-link"
            [class.nav-link--active]="isRouteActive('/dashboard')"
            matTooltip="Visão geral do sistema"
            matTooltipPosition="below"
          >
            <mat-icon class="nav-icon">dashboard</mat-icon>
            <span class="nav-label">Dashboard</span>
          </a>

          <a
            mat-button
            routerLink="/customers"
            class="nav-link"
            [class.nav-link--active]="isRouteActive('/customers')"
            matTooltip="Gerenciar clientes"
            matTooltipPosition="below"
          >
            <mat-icon class="nav-icon">people</mat-icon>
            <span class="nav-label">Clientes</span>
          </a>
        </div>
      </nav>

      <!-- User Menu -->
      <div class="user-section">
        <!-- User Avatar with Menu -->
        <button
          mat-icon-button
          class="user-avatar-button"
          [matMenuTriggerFor]="userMenu"
          matTooltip="Menu do usuário"
        >
          <div class="user-avatar">
            <span class="user-initials">{{ getUserInitials() }}</span>
          </div>
        </button>

        <!-- Mobile Menu Toggle -->
        <button
          mat-icon-button
          class="mobile-menu-toggle"
          (click)="toggleMobileMenu()"
          [class.mobile-menu-toggle--active]="isMobileMenuOpen()"
        >
          <mat-icon>{{ isMobileMenuOpen() ? "close" : "menu" }}</mat-icon>
        </button>
      </div>

      <!-- User Dropdown Menu -->
      <mat-menu #userMenu="matMenu" class="user-dropdown">
        <div class="user-info-header">
          <div class="user-avatar-large">
            <span class="user-initials-large">{{ getUserInitials() }}</span>
          </div>
          <div class="user-details">
            <span class="user-name">{{ getUserName() }}</span>
            <span class="user-email">{{
              authService.currentUser()?.email
            }}</span>
          </div>
        </div>

        <div class="menu-divider"></div>

        <button mat-menu-item class="menu-item" disabled>
          <mat-icon>person</mat-icon>
          <span>Perfil</span>
          <span class="menu-badge">Em breve</span>
        </button>

        <button mat-menu-item class="menu-item" disabled>
          <mat-icon>settings</mat-icon>
          <span>Configurações</span>
          <span class="menu-badge">Em breve</span>
        </button>

        <div class="menu-divider"></div>

        <button
          mat-menu-item
          class="menu-item menu-item--logout"
          (click)="logout()"
        >
          <mat-icon>logout</mat-icon>
          <span>Sair</span>
        </button>
      </mat-menu>
    </mat-toolbar>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav" [class.mobile-nav--open]="isMobileMenuOpen()">
      <div class="mobile-nav-content">
        <a
          mat-button
          routerLink="/dashboard"
          class="mobile-nav-link"
          [class.mobile-nav-link--active]="isRouteActive('/dashboard')"
        >
          <mat-icon>dashboard</mat-icon>
          <span>Dashboard</span>
        </a>

        <a
          mat-button
          routerLink="/customers"
          class="mobile-nav-link"
          [class.mobile-nav-link--active]="isRouteActive('/customers')"
        >
          <mat-icon>people</mat-icon>
          <span>Clientes</span>
        </a>
      </div>
    </nav>
  </header>
  }

  <!-- Main Content -->
  <main
    class="app-main"
    [class.app-main--with-header]="authService.isAuthenticated()"
    [class.app-main--mobile-menu-open]="isMobileMenuOpen()"
  >
    <router-outlet />
  </main>

  <!-- Mobile Menu Overlay -->
  @if (isMobileMenuOpen()) {
  <div class="mobile-overlay" (click)="toggleMobileMenu()"></div>
  }
</div>
